<template>
    <div class="login-container">
        <div class="box">
            <div class="hedaer">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" t="1698472171565"
                    class="icon" viewBox="0 0 1024 1024" version="1.1" p-id="9196" width="32" height="32">
                    <path
                        d="M674.083 889.935c0-12.076-10.057-21.865-22.463-21.865H540.014V655.808l8.613-6.566c174.398-132.947 266.495-319.28 276.63-560.752 0.02-12.97-10.039-22.76-22.446-22.76l-597.546 0.002c-13.915 0.878-23.26 11.315-22.41 23.362 8.547 121.225 26.696 213.015 54.005 274.952 30.805 69.865 104.315 169.445 220.26 297.672l5.6 6.194V869.53h-110.5c-12.406 0-22.463 9.79-22.463 21.865v67.875h344.326v-69.335zM138.333 96.256c-0.102-1.385-0.201-2.775-0.3-4.168-2.548-36.142 25.487-67.452 62.618-69.933 2.305-0.128 2.305-0.128 4.614-0.153L802.811 22c37.22 0 67.392 29.369 67.392 65.597-0.09 2.13-0.184 4.255-0.285 6.376 112.559-0.311 158.461 50.548 119.36 141.12-34.54 80.01-137.369 197.411-309.303 354.52l-0.38-0.395c-28.398 31.343-59.95 60.606-94.654 87.796V824.34h66.679c37.218 0 67.39 29.368 67.39 65.596V1003H284.83V891.395c0-36.227 30.172-65.595 67.39-65.595h65.574V684.402c-36.746-40.826-69.287-78.847-97.63-114.096C166.173 427.269 72.215 318.6 37.652 242.536c-40.165-88.394-1.766-141.44 100.68-146.28z m3.693 43.56c-73.633 2.347-89.916 26.427-63.287 85.03 18.712 41.181 58.388 94.98 118.895 161.031-0.704-1.54-1.39-3.067-2.059-4.584-25.775-58.457-43.528-138.859-53.55-241.478z m724.907-2.097c-9.25 103.443-33.579 196.833-72.967 280.245 81.616-84.569 132.995-151.401 153.894-199.812 25.415-58.87 4.703-81.771-80.927-80.433z"
                        fill="#FFC000" p-id="9197" />
                    <path
                        d="M391 921v-40h244v40zM757.288 144L798 156.785c-2.367 7.317-4.744 15.088-7.288 23.766-3.097 10.566-13.095 46.22-14.39 50.728-5.755 20.018-10.348 34.431-15.228 47.113a374.87 374.87 0 0 1-6.56 15.946c-9.154 20.87-31.171 59.99-30.432 58.357l-39.024-17.149c0.304-0.673 22.16-39.508 30.231-57.91 2.03-4.63 3.974-9.345 5.831-14.171 4.349-11.3 8.623-24.713 14.069-43.66 1.232-4.285 11.27-40.086 14.452-50.938 2.645-9.023 5.132-17.153 7.627-24.867z m-83.202 211.566l33.73 25.846c-2.275 2.884-8.824 11.265-9.62 12.276-3.38 4.296-5.842 7.33-8.323 10.216a154.11 154.11 0 0 1-6.844 7.473c-5.985 6.11-12.814 12.003-22.695 19.623L634 397.843c8.44-6.508 13.841-11.17 18.287-15.708a111.977 111.977 0 0 0 4.982-5.446c2.006-2.333 4.124-4.943 7.159-8.8 0.73-0.927 7.304-9.34 9.658-12.323z"
                        fill="#FFC000" p-id="9198" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" t="1698472265420"
                    class="icon" viewBox="0 0 1898 1024" version="1.1" p-id="10227" width="59.3125" height="32">
                    <path
                        d="M168.376422 836.768973l-46.812364 0 0 66.423945 46.812364 0L168.376422 836.768964zM157.621965 892.437402l-24.671049 0 0-44.915064 24.671049 0L157.621965 892.437444zM110.177178 813.36279l0-10.754441-43.649173 0 0 140.438116 11.387898 0L77.915902 813.362781l19.610557 0c-5.06153 20.242944-9.280819 34.794086-12.651725 43.649126 10.535424 12.651725 15.596954 24.671027 15.182541 36.057907 0 8.442675-2.747699 12.652749-8.223642 12.652749-1.690624 0.423629-4.428083 0.423629-8.223642 0-2.116301 0-3.795661 0-5.06153 0 0.840192 1.6896 1.473638 5.059482 1.897267 10.121011 0.415437 0.850432 0.633446 1.482854 0.633446 1.897267 5.901722 0 10.961203-0.206746 15.182541-0.632422 10.121011-0.414413 15.182541-8.223642 15.182541-23.406182 0.414413-12.228096-4.428083-25.08759-14.550016-38.588723C98.573312 849.638707 103.000371 835.721011 110.177178 813.36279zM117.13495 815.893504l68.321246 0 0 102.481868c0.415437 7.166566-3.587891 10.537472-12.019302 10.121011-9.280819 0-16.872038-0.216986-22.772736-0.632422 0 0.840192 0.414413 2.530714 1.264845 5.06153 0.414413 3.370906 0.840192 6.107341 1.264845 8.223642 10.961203 0 18.552422-0.219034 22.772736-0.633446 15.182541 0.840192 22.349107-6.54336 21.508915-22.140314L197.475498 815.893539l13.916609 0 0-11.385851-94.257162 0L117.134945 815.893539zM380.220109 905.722675l60.729996 0 0-10.754441L380.220159 894.968234l0-17.713257 55.037071 0 0-75.279038L313.798261 801.97594l0 75.279038 55.036047 0 0 17.713257-60.728973 0 0 10.754441 60.728973 0 0 19.610557-70.218546 0 0 10.120984L451.072162 935.454216l0-10.120984L380.220159 925.333233 380.220159 905.722643zM380.220109 812.096922l43.649173 0 0 22.773749L380.220159 834.87067 380.220159 812.096891zM380.220109 844.992614l43.649173 0 0 22.140292L380.220159 867.132906 380.220159 844.992647zM368.834355 867.132928 325.184112 867.132928l0-22.140292 43.649173 0L368.833285 867.132938zM368.834355 834.871706 325.184112 834.871706l0-22.773749 43.649173 0L368.833285 834.871663zM676.203213 800.077619l-75.912495 0 0 10.754441 63.25973 0-5.059482 53.138739-38.589704 0 3.795661-43.649126-12.019308 0-5.059482 54.403584 66.421898 0c-0.849408 19.403878-1.6896 33.112678-2.530714 41.119437-0.423629 8.440627-5.277491 12.651725-14.548992 12.651725-14.342349 0-22.99177-0.216986-25.936896-0.632422 0 0.840192 0.206746 2.312806 0.632422 4.428083 0.415437 3.370906 0.840192 6.326374 1.264845 8.85719 6.326374 0 14.550016 0 24.671027 0 16.447386-0.425677 25.08759-8.016998 25.936896-22.77376 0.840192-9.69728 1.680384-27.834266 2.530714-54.403584l-15.182499 0L676.203213 800.077619zM595.230208 838.033818l0-10.754441-27.201807 0c0.415437-2.530714 1.047962-6.53312 1.898291-12.019302 1.264845-8.430387 2.105037-14.756762 2.530714-18.977075l-12.019302-1.898291c0 1.264845-0.216986 3.381146-0.633446 6.326374-1.6896 11.811533-2.954445 20.667699-3.794637 26.568397l-15.182499 0 0 10.754441 13.916609 0c-4.221338 21.934592-7.592243 37.322752-10.122035 46.179942 2.530714 2.114253 6.109389 5.485158 10.754458 10.121011 4.63575 4.647014 8.223642 8.016998 10.754458 10.122035-7.590195 11.38688-16.873062 20.875469-27.834266 28.467712 2.530714 3.370906 4.842496 6.74089 6.958797 10.121011 13.491917-11.385856 23.189197-21.508915 29.09911-30.364979 1.264845 1.264845 2.945229 2.954445 5.06153 5.059482 4.63575 5.06153 8.223642 8.431411 10.754458 10.122035l9.489613-8.223642c-6.326374-6.326374-12.870758-12.434739-19.611546-18.345677C587.638886 886.961459 592.699392 865.869107 595.230208 838.033818zM571.824026 893.703373c-1.264845-0.840192-2.954445-2.312806-5.059482-4.428083-4.221338-4.212122-7.592243-7.166566-10.122035-8.85719 3.370906-11.802317 6.326374-25.936896 8.85719-42.384282l18.344667 0C582.152704 861.233254 578.1504 879.785677 571.824026 893.703373zM597.128499 895.60064l67.687834 0 0 11.387904-67.687834 0 0-11.387904ZM915.883213 800.077619l-75.912495 0 0 10.754441 63.25973 0-5.059482 53.138739L859.580242 863.970799l3.795661-43.649126-12.019308 0-5.059482 54.403584 66.421898 0c-0.849408 19.403878-1.6896 33.112678-2.530714 41.119437-0.423629 8.440627-5.277491 12.651725-14.548992 12.651725-14.342349 0-22.99177-0.216986-25.936896-0.632422 0 0.840192 0.206746 2.312806 0.632422 4.428083 0.415437 3.370906 0.840192 6.326374 1.264845 8.85719 6.326374 0 14.550016 0 24.671027 0 16.447386-0.425677 25.08759-8.016998 25.936896-22.77376 0.840192-9.69728 1.680384-27.834266 2.530714-54.403584l-15.182499 0L915.883213 800.077619zM834.909184 838.033818l0-10.754441-27.201807 0c0.415437-2.530714 1.047962-6.53312 1.898291-12.019302 1.264845-8.430387 2.105037-14.756762 2.530714-18.977075l-12.019302-1.898291c0 1.264845-0.216986 3.381146-0.633446 6.326374-1.6896 11.811533-2.954445 20.667699-3.794637 26.568397l-15.182499 0 0 10.754441 13.916609 0c-4.221338 21.934592-7.592243 37.322752-10.122035 46.179942 2.530714 2.114253 6.109389 5.485158 10.754458 10.121011 4.63575 4.647014 8.223642 8.016998 10.754458 10.122035-7.590195 11.38688-16.873062 20.875469-27.834266 28.467712 2.530714 3.370906 4.842496 6.74089 6.958797 10.121011 13.491917-11.385856 23.189197-21.508915 29.09911-30.364979 1.264845 1.264845 2.945229 2.954445 5.06153 5.059482 4.63575 5.06153 8.223642 8.431411 10.754458 10.122035l9.489613-8.223642c-6.326374-6.326374-12.870758-12.434739-19.611546-18.345677C827.317965 886.961459 832.37847 865.869107 834.909184 838.033818zM811.503002 893.703373c-1.264845-0.840192-2.954445-2.312806-5.059482-4.428083-4.221338-4.212122-7.592243-7.166566-10.122035-8.85719 3.370906-11.802317 6.326374-25.936896 8.85719-42.384282l18.344667 0C821.831782 861.233254 817.829376 879.785677 811.503002 893.703373zM836.807475 895.60064l67.687834 0 0 11.387904-67.687834 0 0-11.387904ZM1150.501683 848.155853l15.182499 0 0-10.122007-15.182499 0 0-12.019308-10.754441 0 0 12.019308-37.322791 0 0-12.019308-10.754441 0 0 12.019308-15.182499 0 0 10.122007 15.182499 0 0 55.036047-16.447366 0 0 10.120984 93.624728 0 0-10.120984-18.344667 0L1150.502707 848.155838zM1139.748352 903.191859l-37.322791 0 0-12.019308 37.322791 0L1139.748352 903.191885zM1139.748352 881.051546l-37.322791 0 0-11.387898 37.322791 0L1139.748352 881.051593zM1139.748352 860.175155l-37.322791 0 0-12.018284 37.322791 0L1139.748352 860.175146zM1072.05847 934.188339c2.946253 3.370906 5.476966 6.534144 7.592243 9.489613 8.006758-4.220314 17.495245-10.337894 28.467712-18.344653 2.105037-1.264845 3.795661-2.312806 5.06153-3.162214l-7.592243-8.223642C1095.041024 921.962291 1083.860787 928.703078 1072.05847 934.188339zM1106.21911 795.649536l-10.753434-3.162214c-5.911962 13.91657-12.652749 25.096806-20.242944 33.527194 1.264845 1.264845 3.162214 3.381146 5.692928 6.326374 0.840192 0.850432 1.473638 1.482854 1.897267 1.897267 3.795661-5.059482 7.374336-10.121011 10.754458-15.182541l74.647628 0 0-10.754441-68.321246 0c0.414413-0.840192 1.047962-2.105037 1.897267-3.794637C1103.472435 800.711066 1104.95529 797.765837 1106.21911 795.649536zM1129.626317 921.537536c10.961203 6.74089 21.083136 14.125363 30.364979 22.140314l8.223642-8.856166c-10.971443-7.175782-21.508915-14.125363-31.629824-20.875469L1129.626317 921.537536zM1044.225229 828.545331l29.099108 0 0-10.120984-54.40259 0 0 10.120984 14.549042 0c0 5.486182-0.216986 12.870758-0.632422 22.140314 0 10.547712-0.216986 17.93024-0.633446 22.142362 0 28.684698-5.059482 48.709632-15.182541 60.097536 2.945229 3.370906 5.475942 6.32535 7.592243 8.856166 12.226048-14.342349 18.552422-37.530522 18.978099-69.586125 0-3.370906 0-6.958797 0-10.754458l16.447366 0c-0.425677 27.41975-1.058099 45.765427-1.898291 55.03703 0 8.015974-3.162214 11.801293-9.489613 11.38688-2.52969 0-6.750003-0.216986-12.651725-0.633446 0.840192 4.63575 1.473638 8.431411 1.898291 11.387904 1.680384 0 5.692928 0 12.018278 0 12.652749 0.840192 18.978099-6.54336 18.978099-22.140314 1.264845-15.183565 1.898291-36.899123 1.898291-65.158042l-26.570397 0C1044.225229 843.312333 1044.225229 835.721011 1044.225229 828.545331zM1051.183002 799.446221c-1.264845-2.530714-2.323046-4.63575-3.162214-6.326374l-10.121011 4.429107c4.210074 7.590195 7.165542 14.341325 8.856166 20.24192l10.754458-3.794637C1055.818854 810.199552 1053.713818 805.356032 1051.183002 799.446221zM1258.600755 817.790874l61.36243 0 0 123.989726 12.651741 0 0-84.136178c16.02263 8.442675 35.425485 19.611546 58.198221 33.528218l8.223642-12.019302c-17.713254-9.695232-38.173184-20.658483-61.362381-32.894771l-5.059482 8.223642 0-36.69138L1407.894004 817.790827l0-12.018284L1258.600795 805.772543 1258.600795 817.79084zM1615.310746 832.34089l-11.38688-7.592243c-6.326374 12.237312-12.651725 22.359245-18.978099 30.366003l-72.11687 0 0 21.507858c0.840192 27.41975-4.644966 46.397952-16.447386 56.9344 2.945229 3.795661 5.692928 7.166566 8.223642 10.121011 14.333133-15.60617 21.083136-37.955174 20.242944-67.055309l0-10.753417L1643.777398 865.869193l0-10.754441-45.546474 0C1602.866688 849.213952 1608.559616 841.621709 1615.310746 832.34089zM1577.986867 798.18025c-0.850432-2.530714-1.482854-4.210074-1.897267-5.06153l-12.019302 3.795661c2.105037 5.06153 4.002304 9.914266 5.692928 14.550016l-69.586113 0 0 10.754441 148.028342 0 0-10.754441-65.790488 0C1581.565542 808.518246 1580.092928 804.091187 1577.986867 798.18025zM1546.357043 829.810176c-1.690624-2.530714-2.955469-4.428083-3.795661-5.692928l-10.754458 6.958797c5.06153 5.910938 10.537472 13.709926 16.447386 23.406182l10.754458-7.590195C1557.318246 843.944755 1553.098957 838.250803 1546.357043 829.810176zM1744.91863 943.045427l11.385851 0 0-10.120984 34.792033 0 0 10.120984 12.019308 0 0-69.586113-58.198215 0L1744.917607 943.045433zM1756.30551 884.21376l34.792033 0 0 39.222138-34.792033 0L1756.30551 884.213761zM1822.096077 943.045427l12.019308 0 0-10.120984 34.792033 0 0 10.120984 11.387898 0 0-69.586113-58.200262 0L1822.095053 943.045433zM1834.115379 884.21376l34.792033 0 0 39.853548-34.792033 0L1834.115379 884.213761zM1865.113805 800.711066l-105.011603 0 0 55.669504 105.011603 0L1865.113805 800.71104zM1853.093478 845.626061l-80.972987 0 0-34.160623 80.972987 0L1853.093478 845.626104zM563.408896 388.410368c35.258675 0 63.837901-28.58025 63.837901-63.838925L627.246797 198.927987l0-7.666978 0-36.50206L399.095947 154.75895l0 26.494668 0 17.674369L399.095947 344.31812l0 8.089624 0 36.002662 160.073234 0L563.408942 388.410405zM465.310106 198.927974l93.859077 0 0 125.642445 0 19.746664L465.310104 344.317083 465.310104 198.927987zM137.53559 196.935475 196.615885 196.935475 196.615885 257.744282 75.154842 257.744282 75.154842 300.07337 179.019264 300.07337 72.507494 415.554867 155.785011 415.554867 230.606643 337.799373 303.473664 415.554867 386.059469 415.554867 280.237363 300.07337 377.089741 300.07337 377.089741 257.744282 264.595354 257.744282 264.595354 196.935475 360.523674 196.935475 360.523674 154.758963 161.363354 154.758963 191.517491 101.386854 113.609523 101.386854 64.168141 196.935475 123.423437 196.935475ZM586.403738 632.947302l0.026607 0L586.430345 445.460416l-59.96862 0L511.434774 445.460416l-327.583191 0-3.56844 0-71.888662 0 0 250.290189 69.128673 0 6.328429 0 338.740833 0C557.502157 695.750656 585.845965 667.726029 586.403738 632.947302zM511.434752 632.947302l0 13.113275-327.583191 0 0-45.319289c22.140314 0 217.955226 0 251.516211 0 35.580006 0 52.355891-57.738752 52.355891-57.738752l-303.872049 0 0-47.852093L511.434774 495.150443 511.434774 632.947291zM1075.504128 440.055091l-81.706733 0 0 195.161017 0.254815 0c2.842931 33.970278 31.295181 60.656333 65.998234 60.656333l0 0.042981L1255.895044 695.915421l0-74.162558L1075.504114 621.752864 1075.504114 440.055053zM970.651136 202.960998l256.180622 0L1226.831758 145.715559 737.757982 145.715559l0 57.245471 142.480733 0L853.834138 325.03808 711.111857 325.03808l0 72.57431c0 0 54.265446 0 127.024026 0l-48.417997 223.833395L711.111857 621.445785l0 74.118553 62.574082 0 53.82953 0.408269c0 0 29.446042 2.538906 37.028045-28.625306 3.080294-12.659917 33.992806-148.009882 61.746176-269.734912 135.242547 0 284.298342 0 284.51328 0 24.906445 0 45.092147-27.879219 45.092147-62.265037L1255.895117 325.038106 942.837358 325.038106C956.969882 263.032013 968.07639 214.266061 970.651136 202.960998zM1536.639283 497.221734 1461.856563 502.963814 1560.333005 264.388915 1486.259507 264.388915 1458.081382 331.871027 1414.946918 331.871027 1490.860442 145.943757 1410.34496 145.943757 1336.270438 331.871027 1336.270438 386.928538 1435.088691 386.928538 1384.141926 508.931994 1336.270438 512.60887 1336.270438 576.791654 1536.639283 557.952717ZM1536.639283 608.868762 1336.270438 624.181248 1336.270438 696.151757 1536.639283 676.96384ZM1822.121574 639.164211l0-0.162713c0 0-31.299277 0.333619-60.348314-28.573082-13.443789-13.380403-21.086208-24.297574-25.413018-32.122061l155.811942-40.671232 0.388915-67.100365-166.646272 41.496064-3.562291-97.422438 170.208545 0 0-53.371048-172.161107 0-3.568435-97.61577 96.984404 0 56.638622 0 21.717646 0-35.86345-117.669478-74.169754-0.237466 17.379635 64.689357-84.632506 0-2.35776-64.451891-79.771568 0 2.658714 64.451891-65.496785 0 0 53.217545 67.692905 0 4.025856 97.61577-90.274263 0 0 53.371048 92.4755 0 4.8128 116.660429-78.732902 19.60233 0 70.880657 88.36567-23.066419c8.147968 15.135437 28.533146 47.091712 66.056602 71.909171 50.310144 33.276416 97.780531 37.731123 97.780531 37.731123l74.903467 0 0-69.162444L1822.121617 639.163189z"
                        p-id="10228" />
                </svg>
            </div>
            <div class="content">
                <a-tabs v-model:activeKey="activeKey">
                    <a-tab-pane key="login" tab="登录">
                        <BaseForm :config="loginConfig" :rules="loginFormRules" v-model:data="loginFormData"
                            style="margin-top: 20px;" ref="loginFormRef">
                        </BaseForm>
                        <a-button type="primary" style="width: 100%;height: 40px; font-weight: bold;"
                            @click="login">登录</a-button>
                    </a-tab-pane>
                    <a-tab-pane key="enroll" tab="注册">
                        <BaseForm :config="enrollConfig" :rules="enrollFormRules" v-model:data="enrollFormData"
                            style="margin-top: 20px;" ref="enrollFormRef">
                        </BaseForm>
                        <a-form>
                            <a-col :span="24">
                                <a-form-item label="验证码" v-bind="validateInfos.verify" :labelCol="{ span: 4 }">
                                    <div style="display: flex;justify-content: space-around;">
                                        <a-input v-model:value="enrollModelRef.verify"></a-input>
                                        <div class="verify">
                                            <a-button @click="send()" type="primary" v-if="time === 0">发送验证码</a-button>
                                            <span v-else class="code">
                                                {{ time + '秒后获取' }}
                                            </span>
                                        </div>
                                    </div>
                                </a-form-item>
                            </a-col>
                        </a-form>
                        <a-button type="primary" style="width: 100%;height: 40px; font-weight: bold;"
                            @click="enroll">注册</a-button>
                    </a-tab-pane>
                    <a-tab-pane key="findPassword" tab="找回密码">
                        <BaseForm :config="findPasswordConfig" :rules="findPasswordFormRules"
                            v-model:data="findPasswordFormData" style="margin-top: 20px;" ref="findPasswordFormRef">
                        </BaseForm>
                        <a-form>
                            <a-col :span="24">
                                <a-form-item label="验证码" v-bind="findPasswordValidateInfos.verify" :labelCol="{ span: 4 }">
                                    <div style="display: flex;justify-content: space-around;">
                                        <a-input v-model:value="findPasswordModelRef.verify"></a-input>
                                        <div class="verify">
                                            <a-button @click="send()" type="primary" v-if="time === 0">发送验证码</a-button>
                                            <span v-else class="code">
                                                {{ time + '秒后获取' }}
                                            </span>
                                        </div>
                                    </div>
                                </a-form-item>
                            </a-col>
                        </a-form>
                        <a-button type="primary" style="width: 100%;height: 40px; font-weight: bold;"
                            @click="findPassword">找回密码</a-button>
                    </a-tab-pane>
                </a-tabs>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'

const activeKey = ref('login')
import BaseForm from "@/components/BaseForm/index.vue";

import { loginConfig, loginFormRules, enrollFormRules, enrollConfig, findPasswordConfig, findPasswordFormRules }
    from "./config";

const loginFormData = ref<any>({});
const loginFormRef = ref();
const login = async () => {
    let status = await loginFormRef.value.validateFn()
    if (status) {
        if (reg.test(loginFormData.value.Email)) {
            let data = {
                ...loginFormData.value,
            }
            loginApi.login(data).then((res: any) => {
                console.log(res, 'reshhh')
                if (res.code === 200) {
                    Cookies.set('token', res.data.token, { expires: 30 })
                    message.success('登录成功!')
                    router.push('/home/homeIndex')
                } else {
                    message.error(res.msg)
                }
            }).catch(error => {
                console.log(error)
            })
        } else {
            message.error('邮箱格式不正确！')
        }

    }
}
import { Form, message } from "ant-design-vue";
const useForm = Form.useForm;
const enrollModelRef = reactive<any>({
    verify: undefined,
});
const enrollRulesRef = reactive({
    verify: [
        {
            required: true,
            message: "请输入验证码",
        },
    ]
});
const { resetFields, validate, validateInfos } = useForm(enrollModelRef, enrollRulesRef);

import { useRouter } from 'vue-router';
const router = useRouter()
const enrollFormData = ref<any>({});
const enrollFormRef = ref();
import Cookies from "js-cookie";
const enroll = async () => {
    let status = await enrollFormRef.value.validateFn();
    if (status) {
        await validate().then(() => {
            if (enrollFormData.value.Password !== enrollFormData.value.ensurePassword) {
                return message.error('密码和确认密码不一致！')
            }
            let data = {
                ...enrollFormData.value,
                ...enrollModelRef
            }
            delete data.ensurePassword
            loginApi.enroll(data).then((res: any) => {
                console.log(res, 'reshhh')
                if (res.code === 200) {
                    Cookies.set('token', res.data.token, { expires: 30 })
                    message.success('注册成功!')
                    router.push('/home/homeIndex')
                } else if (res.code === 201) {
                    message.error(res.msg)
                } else {
                    message.error(res.msg)
                }
            })
        }).catch(error => {
            console.log(error)
        })
    }
}

import { useCountDown } from '@/compositions/index'
const { start, time } = useCountDown()
const isSendCode = ref(false)
const reg = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/
import { loginApi } from '@/api/user/login'
const sendVerifyCode = (email: string) => {
    loginApi.getverifyCode(email).then((res) => {
        message.success('发送验证码成功!')
    }).catch(error => {
        console.log(error)
    })
    isSendCode.value = true
    start(60)
}
const send = async () => {
    if (activeKey.value === 'enroll' && reg.test(enrollFormData.value.Email)) {
        sendVerifyCode(enrollFormData.value.Email)
    } else if (activeKey.value === 'findPassword' && reg.test(findPasswordFormData.value.Email)) {
        sendVerifyCode(findPasswordFormData.value.Email)
    } else {
        message.error('邮箱格式不正确!')
    }
}

const findPasswordFormData = ref<any>({});
const findPasswordModelRef = reactive<any>({
    verify: undefined,
});
const findPasswordFormRef = ref();
const findPasswordRulesRef = reactive({
    verify: [
        {
            required: true,
            message: "请输入验证码",
        },
    ]
});
const { validate: findPasswordValidate, validateInfos: findPasswordValidateInfos } = useForm(findPasswordModelRef, findPasswordRulesRef);

const findPassword = async () => {
    let status = await findPasswordFormRef.value.validateFn()
    if (status) {
        console.log('hhh')
        await findPasswordValidate().then(() => {
            let data = {
                ...findPasswordFormData.value,
                ...findPasswordModelRef
            }
            delete data.ensurePassword
            loginApi.findPassword(data).then((res: any) => {
                console.log(res, 'reshhh')
                if (res.code === 200) {
                    message.success(res.msg)
                    activeKey.value = 'login'
                } else {
                    message.error(res.msg)
                }
            })
        }).catch(error => {
            console.log(error)
        })
    }
}
</script>

<style lang="less" scoped>
.login-container {
    background: rgb(247, 248, 250);
    display: flex;
    justify-content: center;
    height: 100%;
    min-height: 700px;

    .box {
        width: 500px;
        margin: 60px auto;
        padding: 20px 0;
        border-radius: 20px;
        box-shadow: 0 0 20px #ccc;

        .hedaer {
            height: 60px;
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        .content {
            margin: 0 20px;
        }
    }

    .verify {
        width: 200px;
        margin-left: 20px;

        .code {
            padding: 10px;
            background: rgb(5, 145, 181);
            color: #fff;
            border-radius: 10px;
        }
    }
}
</style>